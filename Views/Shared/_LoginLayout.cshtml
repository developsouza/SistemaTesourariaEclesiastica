<!DOCTYPE html>
<html lang="pt-BR" class="h-100">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Sistema de Tesouraria Eclesiástica</title>

    <!-- Bootstrap 5.3 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- CSS Customizado -->
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/login.css" asp-append-version="true" />

    <!-- Meta tags -->
    <meta name="description" content="Sistema de Gestão de Tesouraria Eclesiástica - Faça login para acessar">
    <meta name="robots" content="noindex, nofollow">
    <meta name="theme-color" content="#2563eb">

    <link rel="icon" type="image/x-icon" href="~/favicon.ico">

    @await RenderSectionAsync("Styles", required: false)
</head>

<body class="h-100">
    <!-- Seletor de Tema -->
    <div class="theme-selector position-fixed top-0 end-0 m-3" style="z-index: 1050;">
        <div class="dropdown">
            <button class="btn btn-light dropdown-toggle shadow-sm" type="button" id="themeDropdown"
                    data-bs-toggle="dropdown" aria-expanded="false" title="Selecionar tema">
                <i id="themeIcon" class="bi bi-sun-fill"></i>
            </button>
            <ul class="dropdown-menu dropdown-menu-end shadow border" aria-labelledby="themeDropdown">
                <li>
                    <button class="dropdown-item d-flex align-items-center" type="button" data-theme="light">
                        <i class="bi bi-sun me-2"></i>
                        <span>Claro</span>
                    </button>
                </li>
                <li>
                    <button class="dropdown-item d-flex align-items-center" type="button" data-theme="dark">
                        <i class="bi bi-moon-stars me-2"></i>
                        <span>Escuro</span>
                    </button>
                </li>
                <li>
                    <button class="dropdown-item d-flex align-items-center" type="button" data-theme="auto">
                        <i class="bi bi-circle-half me-2"></i>
                        <span>Automático</span>
                    </button>
                </li>
            </ul>
        </div>
    </div>

    <!-- Preloader -->
    <div class="preloader" id="preloader">
        <div class="preloader-content">
            <div class="preloader-logo">
                <i class="bi bi-bank2"></i>
            </div>
            <div class="preloader-text">Sistema de Tesouraria</div>
            <div class="preloader-spinner"></div>
        </div>
    </div>

    <!-- Conteúdo principal -->
    <main role="main" class="auth-container fade-in">
        @RenderBody()
    </main>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
    <script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>

    <script>
        // Remover preloader quando a página carregar
        window.addEventListener('load', function() {
            const preloader = document.getElementById('preloader');
            if (preloader) {
                setTimeout(() => {
                    preloader.classList.add('fade-out');
                    setTimeout(() => {
                        preloader.style.display = 'none';
                    }, 500);
                }, 800);
            }
        });

        // Prevenir múltiplos submits
        document.addEventListener('DOMContentLoaded', function() {
            const forms = document.querySelectorAll('form');
            forms.forEach(form => {
                form.addEventListener('submit', function() {
                    const submitBtn = this.querySelector('button[type="submit"]');
                    if (submitBtn && !submitBtn.disabled) {
                        submitBtn.disabled = true;
                        submitBtn.classList.add('btn-loading');

                        // Re-habilitar após 5 segundos (fallback)
                        setTimeout(() => {
                            submitBtn.disabled = false;
                            submitBtn.classList.remove('btn-loading');
                        }, 5000);
                    }
                });
            });

            // Auto-dismiss alerts
            const alerts = document.querySelectorAll('.alert-dismissible');
            alerts.forEach(alert => {
                setTimeout(() => {
                    const bsAlert = new bootstrap.Alert(alert);
                    bsAlert.close();
                }, 5000);
            });
        });

        // Tratamento de erros global
        window.addEventListener('error', function(e) {
            console.error('Erro capturado:', e.error);
        });
    </script>

    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>