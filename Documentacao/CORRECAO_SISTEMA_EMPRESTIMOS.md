# ?? SISTEMA DE REPASSE - DÍZIMO DOS DÍZIMOS (20%)

## ?? O QUE É O DÍZIMO DOS DÍZIMOS?

O **Dízimo dos Dízimos** é um **repasse financeiro obrigatório** que a Sede Local faz mensalmente ao **Templo Central da Convenção**.

### Características Principais:

- ?? **Percentual:** 20% das receitas mensais da Sede Local
- ??? **Destino:** Templo Central da Convenção
- ? **Frequência:** Mensal (calculado no fechamento)
- ?? **Base de Cálculo:** Total de Receitas (Entradas) do mês
- ? **Obrigatoriedade:** Repasse institucional previsto em estatuto

---

## ?? COMO FUNCIONA O REPASSE

```
???????????????????????????????????????????????????????????????
? FLUXO DO DÍZIMO DOS DÍZIMOS (20%)  ?
???????????????????????????????????????????????????????????????

1. SEDE LOCAL faz lançamentos durante o mês
   ?
2. Final do mês: Fechamento de Período
   ?
3. Sistema calcula:
   Total de Receitas = R$ 50.000,00
   ?
4. Sistema aplica RATEIO AUTOMÁTICO:
   20% de R$ 50.000 = R$ 10.000,00
   ?
5. ItemRateioFechamento criado:
   Origem: SEDE LOCAL
   Destino: TEMPLO CENTRAL (Fundo)
   Valor: R$ 10.000,00
   ?
6. Fechamento APROVADO
   ?
7. Valor registrado como A REPASSAR
   ?
8. Tesouraria efetua o repasse físico/digital
   ao Templo Central
   ?
9. Valor é deduzido do saldo da Sede Local
```

---

## ?? EXEMPLO PRÁTICO MENSAL

```
???????????????????????????????????????????????????????????
JANEIRO/2024 - SEDE LOCAL
???????????????????????????????????????????????????????????

MOVIMENTAÇÕES DO MÊS:
  Dízimos recebidos: R$ 35.000,00
  Ofertas: R$ 8.000,00
  Votos: R$ 7.000,00
  ????????????????????????????????
  TOTAL DE RECEITAS: R$ 50.000,00

DESPESAS DO MÊS:
  Energia elétrica: R$ 1.500,00
  Água: R$ 300,00
  Material de limpeza: R$ 450,00
  Outros: R$ 3.750,00
  ?????????????????????????????????
  TOTAL DE DESPESAS: R$ 6.000,00

FECHAMENTO MENSAL (31/01):
  ?? Base de cálculo: R$ 50.000,00 (Receitas)
  ?? Dízimo dos Dízimos (20%): R$ 10.000,00
  
  Status: PENDENTE de aprovação

APROVAÇÃO (05/02):
  ? Fechamento APROVADO
  ?? Valor a repassar: R$ 10.000,00

REPASSE AO TEMPLO CENTRAL:
  ?? Transferência/Depósito: R$ 10.000,00
  ?? Data: 10/02/2024
  ??? Destino: Templo Central da Convenção
  
???????????????????????????????????????????????????????????
RESULTADO DA SEDE LOCAL (após repasse):
???????????????????????????????????????????????????????????

Receitas: R$ 50.000,00
Despesas: R$ 6.000,00
Repasse (20%): R$ 10.000,00
?????????????????????????????????
SALDO LÍQUIDO: R$ 34.000,00
```

---

## ? CORREÇÕES APLICADAS NO SISTEMA

### 1. Centro de Custo "FUNDO - Repasse Templo Central"

```csharp
var fundo = new CentroCusto
{
    Nome = "FUNDO - Repasse Templo Central",
    Tipo = TipoCentroCusto.Financeiro,
 Descricao = "Dízimo dos Dízimos (20%) - Valor repassado mensalmente para o Templo Central da Convenção",
    Ativo = true
};
```

### 2. Regra de Rateio Automática

```csharp
var regraRateio = new RegraRateio
{
    Nome = "Dízimo dos Dízimos (20%)",
    Descricao = "Repasse mensal de 20% das receitas da Sede Local para o Templo Central da Convenção",
    CentroCustoOrigemId = sedeId,// SEDE LOCAL
    CentroCustoDestinoId = fundoId,   // TEMPLO CENTRAL
    Percentual = 20.00m,      // 20%
  Ativo = true
};
```

---

## ?? PASSOS PARA APLICAR A CORREÇÃO

### Opção 1: Banco de Dados Novo

```bash
# Recriar banco com as correções
dotnet ef database drop --force
dotnet ef database update
dotnet run
```

### Opção 2: Banco Existente (Manual)

#### 1. Criar Centro de Custo

```
Cadastros > Centros de Custo > Novo

Nome: FUNDO - Repasse Templo Central
Tipo: Financeiro
Descrição: Dízimo dos Dízimos (20%) - Repasse ao Templo Central
Ativo: ? Sim
```

#### 2. Criar Regra de Rateio

```
Cadastros > Regras de Rateio > Nova Regra

Nome: Dízimo dos Dízimos (20%)
Descrição: Repasse mensal ao Templo Central
Origem: Sede ?
Destino: FUNDO - Repasse Templo Central ??
Percentual: 20.00
Ativo: ? Sim
```

---

## ?? COMO VERIFICAR SE ESTÁ FUNCIONANDO

### 1. Fazer Fechamento de Teste

```
1. Lançar Entradas na SEDE:
   - Valor: R$ 10.000,00
   
2. Criar Fechamento Mensal

3. Verificar Rateios:
   ? Dízimo dos Dízimos (20%)
   ? Destino: FUNDO - Repasse Templo Central
   ? Valor: R$ 2.000,00
   
4. Aprovar Fechamento

5. Verificar em Empréstimos > Detalhamento:
   ? Saldo a Repassar: R$ 2.000,00
```

### 2. Visualizar Valores a Repassar

```
Acesse: Empréstimos > Novo Empréstimo

Detalhamento do Fundo:
???????????????????????????????????????
? ?? VALORES A REPASSAR    ?
?            ?
? Total de Rateios: R$ 2.000,00      ?
? Repassado: R$ 0,00                 ?
? Pendente: R$ 2.000,00    ?
???????????????????????????????????????
```

---

## ?? PERGUNTAS FREQUENTES

**Q: Quando devo fazer o repasse ao Templo Central?**
R: Após a aprovação do fechamento mensal, geralmente na primeira quinzena do mês seguinte.

**Q: O repasse é calculado sobre o quê?**
R: Sobre o **Total de Receitas** (todas as entradas do mês), não sobre o saldo ou lucro.

**Q: E se a Sede tiver prejuízo no mês?**
R: O repasse ainda deve ser feito, pois é calculado sobre as receitas, não sobre o resultado.

**Q: Como registro que o repasse foi feito?**
R: Use o módulo de Empréstimos para registrar que o valor foi "retirado" (repassado).

**Q: O valor pode ser parcelado?**
R: Depende do acordo com o Templo Central. O ideal é repassar o valor integral.

**Q: E se não conseguir repassar no mês?**
R: O valor fica pendente e deve ser repassado assim que possível.

---

## ?? RELATÓRIOS

### Acompanhamento de Repasses

```
???????????????????????????????????????????????????????????
RELATÓRIO DE REPASSES AO TEMPLO CENTRAL - 2024
???????????????????????????????????????????????????????????

MÊS      | RECEITAS   | 20%        | REPASSADO | PENDENTE
?????????????????????????????????????????????????????????
Janeiro  | R$ 50.000  | R$ 10.000  | R$ 10.000 | R$ 0
Fevereiro| R$ 45.000  | R$ 9.000   | R$ 9.000  | R$ 0
Março    | R$ 52.000  | R$ 10.400  | R$ 0      | R$ 10.400
?????????????????????????????????????????????????????????
TOTAL    | R$ 147.000 | R$ 29.400  | R$ 19.000 | R$ 10.400
```

---

## ?? AVISOS IMPORTANTES

### 1. Base de Cálculo

? **CORRETO:** 20% sobre RECEITAS
```
Receitas: R$ 50.000
Repasse: R$ 50.000 × 20% = R$ 10.000
```

? **ERRADO:** 20% sobre saldo/lucro
```
Saldo: R$ 44.000 (receitas - despesas)
Repasse: R$ 44.000 × 20% = R$ 8.800 ?
```

### 2. Fechamentos Aprovados

Apenas fechamentos **APROVADOS** geram obrigação de repasse.

### 3. Comprovação

Guarde comprovantes de todos os repasses feitos ao Templo Central.

---

## ?? REFERÊNCIAS NO CÓDIGO

### Cálculo do Saldo a Repassar

```csharp
// EmprestimosController.cs
private async Task<decimal> CalcularSaldoFundo()
{
    // Total de rateios aprovados (valores a repassar)
    var totalRateios = await _context.ItensRateioFechamento
   .Include(i => i.FechamentoPeriodo)
        .Where(i => i.FechamentoPeriodo.Status == StatusFechamentoPeriodo.Aprovado)
        .SumAsync(i => i.ValorRateio);
    
 // Repasses já efetuados (registrados como empréstimos)
    var totalRepassado = await _context.Emprestimos
        .Where(e => e.Status == StatusEmprestimo.Ativo)
        .SumAsync(e => e.SaldoDevedor);
    
    // Saldo pendente de repasse
    return totalRateios - totalRepassado;
}
```

---

**? Sistema de Repasse ao Templo Central CONFIGURADO!**
